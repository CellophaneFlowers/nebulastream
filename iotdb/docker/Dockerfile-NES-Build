FROM ubuntu:18.04

RUN apt-get update -y && apt-get install -y cmake clang llvm-dev git binutils-dev libdw-dev libzmq3-dev libboost-all-dev liblog4cxx-dev libcpprest-dev libssl-dev clang-format librdkafka1 librdkafka++1 librdkafka-dev wget
RUN git clone https://github.com/actor-framework/actor-framework.git
RUN cd actor-framework && git checkout 0.17.3 && bash configure && cd build && make && make install
RUN wget https://github.com/mfontanini/cppkafka/archive/v0.3.1.tar.gz -O cppkafka-0.3.1.tar.gz && tar -xzf cppkafka-0.3.1.tar.gz && mkdir -p cppkafka-0.3.1/build && cd cppkafka-0.3.1/build && cmake -DCPPKAFKA_BUILD_SHARED=ON -DCPPKAFKA_DISABLE_TESTS=ON -DCPPKAFKA_DISABLE_EXAMPLES=ON -DCPPKAFKA_RDKAFKA_STATIC_LIB=OFF .. && make -j -w && make install
RUN apt-get remove -y git && apt-get remove -y wget
RUN rm -rf actor-framework cppkafka-0.3.1.tar.gz cppkafka-0.3.1

ADD ./scripts/entrypoint-nes-build.sh /entrypoint.sh

EXPOSE 8081
EXPOSE 38938
ENTRYPOINT ["/entrypoint.sh"]
